!function(e){function n(e){for(var n,t,a,i,u,c={},p=e.split(/\r\n|\r|\n/),l=p.length,s=0;s<l;s++)if(""!=p[s]&&p[s].toUpperCase()!=o&&p[s].toUpperCase()!=f){var h=p[s],g=function(e){return e+1<l&&(" "==p[e+1][0]||"\t"==p[e+1][0])};if(g(s))for(;g(s);)h+=p[s+1].trim(),s++;if(n=h.split(":"),t=n.shift(),a=n.join(":"),u=!1,i={},t.match(/;/)){t=t.replace(/\\;/g,"ΩΩΩ").replace(/\\,/,",");var v=t.split(";").map(function(e){return e.replace(/ΩΩΩ/g,";")});t=v.shift(),v.forEach(function(e){var n=e.split("=");n[0]=n[0].toLowerCase(),0!==n[0].length&&(i[n[0]]?i[n[0]].push(n[1]):i[n[0]]=[n[1]])})}if(a=a.replace(/\\n/g,"\n"),a=r(a),t.match(/\./)){var d=t.split(".");t=d[1],u=d[0]}var m={value:a};Object.keys(i).length&&(m.meta=i),u&&(m.namespace=u),0!==t.indexOf("X-")&&(t=t.toLowerCase()),"undefined"==typeof c[t]?c[t]=[m]:c[t].push(m)}return c}function r(e){return e.match(i)?(e=e.replace(/\\,/g,","),t(e,";")):e.match(u)?(e=e.replace(/\\;/g,";"),t(e,",")):e.replace(/\\,/g,",").replace(/\\;/g,";")}function t(e,n){var r=new RegExp(n),t=new RegExp("\\\\"+n,"g");return e=e.replace(t,"ΩΩΩ"),e.match(r)?(e=e.split(n),e=e.map(function(e){return e.replace(/ΩΩΩ/g,n)})):e=e.replace(/ΩΩΩ/g,n),e}function a(e,n){var r=[o],t="";n&&!e.version&&(e.version=[{value:"3.0"}]),n&&!e.uid&&(e.uid=[{value:c()}]);var a=function(e){return"undefined"==typeof e?"":e.replace(/\n/g,"\\n").replace(/;/g,"\\;").replace(/,/g,"\\,")},i=function(e){return"undefined"==typeof e?"":e.replace(/\n/g,"\\n").replace(/;/g,"\\;")};return Object.keys(e).forEach(function(n){e[n]&&"function"==typeof e[n].forEach&&e[n].forEach(function(e){if("undefined"!=typeof e.value&&(""!=e.value||l.indexOf(n)!==-1)){if(e.value instanceof Array){for(var o=!0,f=0;f<e.value.length;f++)if("undefined"!=typeof e.value[f]&&""!=e.value[f]){o=!1;break}if(o)return}if(t="",e.namespace&&(t+=e.namespace+"."),t+=0===n.indexOf("X-")?n:n.toUpperCase(),"object"==typeof e.meta&&Object.keys(e.meta).forEach(function(n){"function"==typeof e.meta[n].forEach&&e.meta[n].forEach(function(e){n.length>0&&(t+="TYPE"===n.toUpperCase()?";"+a(n.toUpperCase())+"="+i(e):";"+a(n.toUpperCase())+"="+a(e))})}),t+=":","string"==typeof e.value)t+=a(e.value);else{var u=p.indexOf(n)!==-1?",":";";t+=e.value.map(function(e){return a(e)}).join(u)}if(t.length>75){var c=t.substr(0,75),s=t.substr(75),h=s.match(/.{1,74}/g);r.push(c),h.forEach(function(e){r.push(" "+e)})}else r.push(t)}})}),r.push(f),r.join("\r\n")}var o="BEGIN:VCARD",f="END:VCARD",i=/[^\\];|^;/,u=/[^\\],|^,/,c=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),p=["nickname","related","categories","pid"],l=["fn"];e.vCard={parse:n,generate:a}}("undefined"!=typeof window?window:module.exports);